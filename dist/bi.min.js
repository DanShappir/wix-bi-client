/*! wix-bi-client - v0.0.3 - 2015-02-19 */!function(a,b){"use strict";"function"==typeof define&&define.amd?define([],b):"object"==typeof module?module.exports=b():a.bi=b()}(this,function(){"use strict";function a(a,b){this.name="BIError",this.message=a,this.desc=b}function b(a,b){return a.replace(/\/$/,"")+"/"+b.replace(/^\//,"")}function c(a){Array.isArray(a)?a.forEach(this):c.call(this,Object.keys(a).map(function(b){return a[b]}))}function d(a,b){return a.fields?Object.keys(b).every(function(c){return typeof b[c]===a.fields[c]}):!0}return a.prototype=Object.create(Error.prototype),a.prototype.constructor=a,function(e,f){function g(a,b,c){function d(a){switch(typeof a){case"boolean":a=a?1:0;case"number":return""+a;case"object":a=JSON.stringify(a);case"string":return encodeURIComponent(a)}}if(c=c||{},a=Object.keys(b).reduce(function(a,e){return e in c?a:a+"&"+e+"="+d(b[e])},a),!f.disabled){var e=new Image;e.src=a}f.log&&console.log("BI:",a)}function h(a){var b=a.endpoint||f.eventsEndPoint||"";return b+"?evid="+a.evid}function i(a){return a&&a.evid&&(a.endpoint||f.eventsEndPoint)}function j(){function b(b){if(!i(b,f.eventsEndPoint))throw new a("Invalid event structure",b);var c=h(b);if(t[c]&&t[c]!==b)throw new a("Event already registered",t[c]);t[c]=b}c.apply(b,arguments)}function k(a){return f.noRegistration||t[h(a)]===a}function l(a,c){var d=b(e,h(a));g(d,c)}function m(b,c){if(c=c||{},!i(b))throw new a("Invalid event structure",b);if(!k(b))throw new a("Event not registered",b);if(!d(b,c))throw new a("Event field validation failed",b);l(b,c)}function n(a){var b=a.endpoint||f.errorsEndPoint||"";return b+"?errc="+a.errc}function o(a){return a&&a.errc&&(a.endpoint||f.errorsEndPoint)}function p(){function b(b){if(!o(b,f.eventsEndPoint))throw new a("Invalid event structure",b);var c=n(b);if(u[c]&&u[c]!==b)throw new a("Event already registered",u[c]);u[c]=b}c.apply(b,arguments)}function q(a){return f.noRegistration||u[n(a)]===a}function r(a,c,d){var f=b(e,n(a));f+="&sev="+d,g(f,c,{sev:!0})}function s(b,c){if(c=c||{},!o(b))throw new a("Invalid error structure",b);if(!q(b))throw new a("Error not registered",b);if(!d(b,c))throw new a("Error field validation failed",b);var e=b.sev||c.sev||30;"string"==typeof e&&(e=v[e]||30),r(b,c,e)}f=f||{};var t={},u={},v={recoverable:10,warning:20,error:30,fatal:40};return{registerEvents:j,event:m,registerErrors:p,error:s}}});